# 文件（C语言）

## 1. 数据的管理与组织



## 2. 文件概述



## 3. 文件的打开和关闭

### 文件打开函数 fopen()

```C
FILE *fopen(const char *filename, const char *mode);
```

**函数原型：**`stdio.h`

**功能：**打开以`filename`所指向的字符串为文件名的文件，使之与一个流关联。返回一个指向`FILE`类型结构变量的指针（后称文件指针）。若打开失败，返回一个空指针`NULL`。

**文本文件（二进制文件）操作模式：**

|   mode    | description                                                  |
| :-------: | :----------------------------------------------------------- |
| **r(b)**  | **打开一个文本文件，可以读取文件。**                         |
| **w(b)**  | **打开一个文本文件，可以写入文件（但会先删除文件原内容）。如果文件不存在，则创建。** |
| **a(b)**  | **打开一个文本文件，可以写入文件，向已有文件的尾部追加内容，如果该文件不存在则创建之。** |
| **r(b)+** | **打开一个文本文件，可以进行更新（即读和写）**               |
| **w(b)+** | **打开一个文本文件，可以进行更新（即读和写）（但会先删除文件原内容）。如果文件不存在，则创建之。** |
| **a(b)+** | **打开一个文本文件，可以进行更新（即读和写），向已有文件的尾部增加内容）。如果文件不存在，则创建之。** |

**注：**

- 如果不能打开指定的文件，则`fopen()`函数返回一个空指针`NULL` 其值在头文件`stdio.h`中被定义为０）。   

    为增强程序的可靠性，常用下面的方法打开一个文件：   

    ```C
    if ((fp = fopen("clients.dat", "w")) == NULL)
        printf("Can't open the file.");
    else
        ...
    ```

- C程序使用一个`\n`表示行尾，Windows文本文件使用回车换行的组合`\r\n`来表示行尾。C程序读取文本文件时，会将`\r\n`转换为`\n`；而写入文件时，会将`\n`转换为`\r\n`。   

- 对文件操作的库函数，函数原型均在头文件`stdio.h`中。后续函数不再赘述。   



### 文件关闭函数 fclose() 

```C
int fclose(FILE *stream);
```

**功能：**关闭文件指针`stream`所指向的文件，将所有未回写缓冲数据写入文件，断开文件和流的关联，释放文件占用的资源，如缓冲区、FILE类型记录占用的内存等。如果正常关闭了文件，则函数返回值为０；否则，返回`EOF`。





## 4. 位置指针和文件定位

**文件位置：**文件中有一个“文件位置指针”，指向下一次读写操作所在字节的整数值。每次读写1个（或1组）数据后，系统自动将文件位置指针移动到下一个读写位置上。  

打开文件时位置指针的起始位置与打开文件的方式有关：

- 以`"r"`、`"w"`方式打开文件，位置指针指向文件头。

- 以`"a"`方式打开文件，位置指针指向文件尾



### 位置指针复位函数 rewind()

```C
void rewind(FILE *stream);
```

**功能：**把 “文件位置指针” 重新定位到文件的起始位置（即0字节处）。



### 随机读写函数 fseek()

```C
int fseek(FILE *stream, long offset, int whence);
```

**功能：**将指定文件的位置指针，从`whence`开始，移动指定的字节数`offset`。

- `whence`三种取值（`stdio.h`中的宏）：

  | macro      | value | meaning      |
  | ---------- | ----- | ------------ |
  | `SEEK_SET` | 0     | 表示文件头   |
  | `SEEK_CUR` | 1     | 表示当前位置 |
  | `SEEK_END` | 2     | 表示文件尾   |

- `offset`（类型为`long`）：

  以参照点为起点，向文件尾方向（位移量 > ０）或文件头方向（位移量 < ０）移动的字节数。



### 文件指针定位函数 ftell()

```C
long ftell(FILE *stream);
```

**功能：**返回文件位置指针的当前位置（用相对于文件头的位移量表示）。

如果返回值为-1L，则表明调用出错。例如：

```C
	...
	offset = ftell(fp);
	if (offset == -1L)
        printf("ftell() error\n");
```



### 函数使用示例

```C
#include<stdio.h>
int main()
{
    FILE *fp;
    if ((fp = fopen(dict.dic)) == NULL)
        printf("Can't open the file.\n");
    else {
        printf("文件位置指针是：%ld\n", ftell(fp));
        rewind(fp); //把文件指针重新定位到起始位置
        p
    }
}
```






## 5. 文件的读写操作

### 读写文件中的一个字符（文本文件）



### 读写文件中的一行字符串（文本文件）



### 对文件格式化读写（文本文件）



### 读写一个数据块（二进制文件）





## 6. 顺序文件的操作



## 7. 随机文件的操作

